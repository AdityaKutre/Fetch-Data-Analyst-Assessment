##Top 5 brands

SELECT 
P.BRAND, COUNT(T.RECEIPT_ID) AS total_receipts 
FROM TRANSACTION_TAKEHOME T 
JOIN USER_TAKEHOME U ON T.USER_ID = U.ID 
JOIN PRODUCTS_TAKEHOME P ON T.BARCODE = P.BARCODE 
WHERE TIMESTAMPDIFF(YEAR, U.BIRTH_DATE, CURDATE()) >= 21 
GROUP BY P.BRAND 
ORDER BY total_receipts DESC LIMIT 5;


##Top 5 brands by sales among users with at least 6 months

SELECT
P.BRAND, SUM(T.FINAL_SALE) AS total_sales 
FROM TRANSACTION_TAKEHOME T 
JOIN USER_TAKEHOME U ON T.USER_ID = U.ID 
JOIN PRODUCTS_TAKEHOME P ON T.BARCODE = P.BARCODE 
WHERE TIMESTAMPDIFF(MONTH, U.CREATED_DATE, CURDATE()) >= 6 
GROUP BY P.BRAND 
ORDER BY total_sales DESC LIMIT 5;


##Percentage sales by category in Health & Wellness

SELECT 
CASE 
WHEN TIMESTAMPDIFF(YEAR, U.BIRTH_DATE, CURDATE()) BETWEEN 18 AND 24 THEN 'Gen Z' 
WHEN TIMESTAMPDIFF(YEAR, U.BIRTH_DATE, CURDATE()) BETWEEN 25 AND 40 THEN 'Millennials' 
WHEN TIMESTAMPDIFF(YEAR, U.BIRTH_DATE, CURDATE()) BETWEEN 41 AND 56 THEN 'Gen X' 
WHEN TIMESTAMPDIFF(YEAR, U.BIRTH_DATE, CURDATE()) >= 57 THEN 'Boomers' 
ELSE 'Unknown' END AS generation, 
SUM(T.FINAL_SALE) AS health_wellness_sales, (SUM(T.FINAL_SALE) / (SELECT SUM(FINAL_SALE) FROM TRANSACTION_TAKEHOME)) * 100 AS percentage_of_total_sales 
FROM TRANSACTION_TAKEHOME T
JOIN USER_TAKEHOME U ON T.USER_ID = U.ID 
JOIN PRODUCTS_TAKEHOME P ON T.BARCODE = P.BARCODE WHERE P.CATEGORY_1 = 'Health & Wellness' 
GROUP BY generation 
ORDER BY health_wellness_sales DESC;



##Fetch power users

SELECT 
    U.ID AS user_id, 
    COUNT(T.RECEIPT_ID) AS total_transactions, 
    SUM(T.FINAL_SALE) AS total_spent
FROM TRANSACTION_TAKEHOME T
JOIN USER_TAKEHOME U ON T.USER_ID = U.ID
GROUP BY U.ID
ORDER BY total_transactions DESC, total_spent DESC
LIMIT 10;


##Leading Brands in Dips&Salsa

SELECT 
    P.BRAND, 
    SUM(T.FINAL_SALE) AS total_sales
FROM TRANSACTION_TAKEHOME T
JOIN PRODUCTS_TAKEHOME P ON T.BARCODE = P.BARCODE
WHERE P.CATEGORY_2 = 'Dips & Salsa'
GROUP BY P.BRAND
ORDER BY total_sales DESC
LIMIT 1;


##Fetch growth Year Over Year

SELECT 
    YEAR(PURCHASE_DATE) AS sales_year,
    SUM(FINAL_SALE) AS total_sales,
    LAG(SUM(FINAL_SALE)) OVER (ORDER BY YEAR(PURCHASE_DATE)) AS previous_year_sales,
    ((SUM(FINAL_SALE) - LAG(SUM(FINAL_SALE)) OVER (ORDER BY YEAR(PURCHASE_DATE))) / 
      LAG(SUM(FINAL_SALE)) OVER (ORDER BY YEAR(PURCHASE_DATE))) * 100 AS year_over_year_growth
FROM TRANSACTION_TAKEHOME
GROUP BY YEAR(PURCHASE_DATE)
ORDER BY sales_year;




